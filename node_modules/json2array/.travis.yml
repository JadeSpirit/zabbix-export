language: node_js
node_js:
- node
- '8'
sudo: false
before_install:
- curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.3.2
- export PATH=$HOME/.yarn/bin:$PATH
- export BRANCH="${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH}"
- yarn global add greenkeeper-lockfile@1
- yarn global add codecov
cache: false
install:
- |
  if [[ $BRANCH == "greenkeeper/"* ]]; then
    echo Greenkeeper build; yarn install;
  else
    echo Normal build - frozen lockfile; yarn install --frozen-lockfile;
  fi
before_script: greenkeeper-lockfile-update
script:
- yarn test
- codecov -f coverage/coverage-final.json
after_script: greenkeeper-lockfile-upload
stages:
- name: test
- name: deploy
  if: tag =~ ^v AND fork = false AND type = push
jobs:
  include:
  - stage: test
    if: type = cron
    node_js: '8'
    os: osx
    osx_image: xcode9.2
  - stage: test
    if: type = cron
    node_js: '7'
  - stage: test
    if: type = cron
    node_js: '6'
  - stage: test
    if: type = cron
    node_js: '5'
  - stage: test
    if: type = cron OR tag =~ ^v
    node_js: '4'
  - stage: deploy
    before_install:
    - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.3.2
    - export PATH=$HOME/.yarn/bin:$PATH
    install: []
    before_script: []
    script:
      - yarn install --frozen-lockfile
      - yarn test
      - yarn tidy-ci
    after_script: []
    deploy:
      provider: npm
      email: github-external-bot@holvonix.com
      skip_cleanup: true
      api_key: "$NPM_API_KEY"
      on:
        tags: true
env:
  global:
  - secure: o65Km+xly84qErkw+PVgfYBQ7wSreOqSnI/7jfO37AEK+vj5AX9TldZS7LtGiDw2QcmsY8o/hQ6j5QJACZjNRrplCs+3hz32upxyfmO4uMKCd3IIP97OsdORaQwnsgZvtyRncPfYNmvxjIgLMEjKjHD1riwTs7nY6pbBEl4WJ3GpO2fDkPVtPexlCs97tg9VZsTlr6zk0us+ztZJNwOxtNlfzErOvRpS7a/jxuJszoaGAcPRMxopEyu9UrDnFHU2/uxtcoTqWXn+y+cAaHGqR9udbQvex4eJuzYBYBneponZDi0ZA8h3nhp+4TNJ6qKUV80hkjYU1S99hrnnvXB7BAape7escVaPo5mx4TTtREwgC9jMNxv/9lBNvCZY5qEYw8sg7fOWPSNzD3geEURstqkhKo7+NqJ69hdIymmI2mWS4xH1OTe5CbzfJ6nlS5FxcWftqxSgkIM0wQJ4vRIlmoW5tFlOWWAcjPFZ6RLOyWpNcn5Gvtvh8Z5vPHu3/fcp6qvZ/LLr2Yrr/Hzda15smdYXpTrzVdttRnase9RUlXzN1i+ptYO4XS8HjyMItARW5YLAFZ5Ia/DhQvvZ6e4idTsN+oWy5BJ36YmBSevwVV7YKdy/W5bGnMqtWM4tkTjfU7dlwduCK+EpHEHDO+wHhq5EU9vFPaP9bXjKt/5dQfc=
  - secure: XwHlAz1/y+KZIevs3rQ1YLTiiMleBmC/VwCVGrsoB58wuzFPbzdzWr6NekBaBYyBqsdUlT+wh7bEwByH1rBAZNO83+UI+d646trhdM5WEKCvMXQlt6z7in2xjNh+eYqKVJ5XMsI6pLXNQH9kiIALI8arEkYArmM/xupydCchI0JoIKU8XJwmUXSS95NyI3sT91IOZVdBYEai8ZkiriSNH/Jx2W7GW7CUOdwiUSxHGlefp7NkxW6VasmUGO46/YVIvvqGGTONNabG2+UTPOED4iKXlhw9efqa75Bb8lAyR6rLaihpLJcuusFLQYQThT8GiEYIFqHFzOGOOyZOiqkPOqgrrY0vs3FIHjQyChDHS9jYEYuHJklxMubfo55j+l7sJ2uXMUfHmPQjPPtJ88OKsuGLzmk95BzryVe+NXmCVcLlBUnrHALO8+W5J/X4yfHjcQbSs1pC3KfkoL6JUvI/MnBioGEZUmjTf00tdaTgumILUc+Gsnqz8+SEejyaPwCEvU7UhgbqoaGzBQCII2xaeHXaxRHSn8k0NoeZ10kiDsi6qAQ90CGOprD1C3Ft9koq3PgzkAsOhICIf3b6mOsXAcGyUbFeoCBYKeJRqjCNLc0HrO1H4PBG4OCvEliEYJbWMid+mNQYqQI5otdk6gMrrHJMphV30uNRfvdChyJTDf8=
  - secure: dD48nVZDi+agtfPoO2KGYblVeWkCq5sWrm86YPa7j93i6hhp35E3hu5I96qpx+rssrsEMluzbIASQ5NP0WgZzNwoGLmE6xpMUSD1WwyiaT5Q0VekIawbTcjwcAynVzFtCBAQaFS0glndc6uulYX/VTH87BhVHn+mL2xj2SktALdlEhL0nHh+tYp2eX+s4+xMfgMDi0h2rIYkbhq51NHtY4CVmYa/tMejJ3u5R7w6y7l+nyl+hSEeS0Bj8S8mgMs5RkEPqdwrv09KX/EtYCkP09GKN4a+1Yay2NytAT/yllBcgkF6GkuEk5GZmCd0L3PaLoObFhFzmwrLQYhizXFq5PqMS+2isJabA9DvGW04Rx2JZpBYUqMHUro81G4THgcR8jelXnt6z3wsaXV0pNyty0bxFGsP5E/LtvAkWDpkNXx4c4C7HKaYHDM3UD01EB0t8//XOpb6EzTNf/3/8z9NiSoFgKJPQqikBiUojNAIDqlgcrCF2U3hkkHYQqFzD5CM6UmeMTtS9XsCdW2W0/d7ZeSK3g8iFz5+qX19t0SWn1ub7OYBzJRy/griWjjOxATjKH9I7OxOzvwjiJ3BlFhqMYdOi2hyqL8PXoDvbk8psTOA9OxmYdVIeaRCo4bPZw5Wq3o9H+i3Ccd+7XHF8Q1zDGuRL76bRV6exGvSR2DsMkQ=
